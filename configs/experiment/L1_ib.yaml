# configs/experiment/L1_ib.yaml

defaults:
  - /base
  - /model/teacher@experiment.teacher1: resnet152
  - /model/teacher@experiment.teacher2: convnext_s
  - /model/student@experiment.model.student: mobilenet_v2_scratch
  - override method@experiment.method: asib_ablation_stage
  - _self_

experiment:
  method_name: asib_ablation_stage
  exp_id: L1_ib
  results_dir: experiments/ablation/L1/results
  teacher1_ckpt: checkpoints/teachers/resnet152_cifar100.pth
  teacher2_ckpt: checkpoints/teachers/convnext_s_cifar100.pth

  dataset: { batch_size: 128, num_workers: 4, data_aug: 1, pin_memory: true, persistent_workers: true, prefetch_factor: 2 }

  num_stages: 1
  student_epochs_per_stage: [240]
  teacher_adapt_epochs: 8           # IB_MBM 학습용 A‑Step
  compute_teacher_eval: true

  

  # KD — inherit from method (two_view)
  kd_center_teacher: false
  enable_kd_after_syn_acc: 0.65

  # IB — inherit from method (ON)
  use_ib: true

  # A‑Step 안정화 (inherit most from method)
  synergy_only_epochs: 2
  synergy_ce_alpha: 1.0
  synergy_logit_scale: 0.80
  use_cccp_in_a: false
  use_cccp: false
  a_step_amp_enabled: true

  # Adapter — inherit from method (distill_out_dim=256)
  use_distillation_adapter: true

  # Optim handled by method; choose ONE of the following policies.
  # Adapter-only teacher tuning (recommended):
  train_distill_adapter_only: true
  teacher_eval_every: 2
  
  # PPF OFF for this rung
  use_partial_freeze: false
  use_amp: true
  amp_dtype: bfloat16
