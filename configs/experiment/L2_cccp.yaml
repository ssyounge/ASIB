# configs/experiment/L2_cccp.yaml

defaults:
  - /base
  - /model/teacher@experiment.teacher1: resnet152
  - /model/teacher@experiment.teacher2: convnext_s
  - /model/student@experiment.model.student: mobilenet_v2_scratch
  - override method@experiment.method: asib_ablation_stage
  - _self_

experiment:
  method_name: asib_ablation_stage
  exp_id: L2_cccp
  results_dir: experiments/ablation/L2/results
  teacher1_ckpt: checkpoints/teachers/resnet152_cifar100.pth
  teacher2_ckpt: checkpoints/teachers/convnext_s_cifar100.pth

  dataset: { batch_size: 128, num_workers: 4, data_aug: 1, pin_memory: true, persistent_workers: true, prefetch_factor: 2 }

  num_stages: 1
  student_epochs_per_stage: [240]
  teacher_adapt_epochs: 8
  compute_teacher_eval: true

  

  # KD — inherit from method (two_view)
  kd_center_teacher: false

  # IB/Adapter — inherit from method (IB ON, distill_out_dim=256)
  use_ib: true
  use_distillation_adapter: true

  # CCCP OFF per success-shot
  use_cccp: false
  use_cccp_in_a: false

  # A‑Step 안정화
  synergy_logit_scale: 0.80
  enable_kd_after_syn_acc: 0.65
  # enable_kd_after_syn_acc: 0.6  # avg KD에서는 B-Step 게이팅에 무의미 (A-Step CCCP 의도 아니면 비활성 권장)

  

  # Optim handled by method; enable teacher adapter tuning
  train_distill_adapter_only: true
  a_step_amp_enabled: true
  teacher_eval_every: 2

  # PPF OFF for this rung
  use_partial_freeze: false
  use_amp: true
  amp_dtype: bfloat16